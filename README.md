# Product Metrics

## Links to Metadata Warehouse SQL Queries
-- replace to snowflake
The following links are to SQL queries that access the Athena QA metadata warehouse, cleaning up their respective tables and making columns easier to parse.

Tables:
- [Datasets](https://github.com/MetaphorData/product-metrics/blob/main/datasets%20expanded.sql)
- [Dashboards](https://github.com/MetaphorData/product-metrics/blob/main/dashboards_expanded.sql)
- [Virtual Views](https://github.com/MetaphorData/product-metrics/blob/main/virtual_views%20expanded.sql)
- [Users](https://github.com/MetaphorData/product-metrics/blob/main/users%20expanded.sql)
- [Knowledge Cards](https://github.com/MetaphorData/product-metrics/blob/main/knowledge_cards%20expanded.sql)


## Amplitude: Event Property Mapping
This repository contains a guide to processing a table describing usage metrics for the [Metaphor](https://metaphor.io) platform.

### Accessing Data
The table can be accessed via Snowflake. Metaphor customers are given permissions to a private view. The table name is events_<customer_id> e.g. events_metaphor.

### Processing Data
Column descriptions can be found in Snowflake itself. Some columns, however, are event properties corresponding to specific EVENT_TYPEs. The following table aims to help identify the relevant columns for a given EVENT_TYPE.

#### Recommended workflow
1. Identify the relevant type of event and its corresponding EVENT_TYPE in the table below
2. Select the relevant properties in the second column that correspond to the key in events_<customer_id> 

   Note: There are repetitions in the properties column, as more than one event-action may have a particular property
   See after table for example select queries

### Properties for all event types
Each event property type contains the following fields: 
| Property Name  | Property Description                                 | Sample Values                                     |
| -------------- | ---------------------------------------------------- | ------------------------------------------------- |
| eventType      |                                                      | page_view_event or interaction_event              |
| deployedDomain | Hosted or deployed environment the event occurred on | stage.metaphor.io, prod.metaphor.io               |
| pageType       |                                                      | full, slide, modal, error                         |
| page           | Page the event occurred on                           | sign_in_page, search_page, person_page, home_page |

### Event types with corresponding properties
<details>
<summary> Each event type has its own relevant fields: </summary>

|                        EVENT_TYPE                       |                                                                                                             Trigger + Event Description                                                                                                             |        Property Name       |                                                    Property Description                                                   |                                                                  Sample Values                                                                  |
|:-------------------------------------------------------:|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|:--------------------------:|:-------------------------------------------------------------------------------------------------------------------------:|:-----------------------------------------------------------------------------------------------------------------------------------------------:|
| General sign_in attempted                               | triggered when a user clicks on a sign in option on the /login route                                                                                                                                                                                | identity_provider          | The name of the identity provider the user attempted to sign in with                                                      | google, okta                                                                                                                                    |
| General sign_in_page viewed                             | When an unauthenticated user lands on the sign in page                                                                                                                                                                                              |                            |                                                                                                                           |                                                                                                                                                 |
| General sign_in failed                                  | triggered when a user unsuccessfully attempts to sign in to the app                                                                                                                                                                                 | reason                     | The reason why the sign in attempt failed                                                                                 | unauthorized                                                                                                                                    |
| PageViewEvent [page name]                               | triggered when the user navigates to a url within Metaphor                                                                                                                                                                                          | hash                       | URL fragment                                                                                                              | section                                                                                                                                         |
|                                                         |                                                                                                                                                                                                                                                     | query                      | The query arguments search parameter in the browser URL                                                                   | contentType=myKnowledgeCards                                                                                                                    |
| Search search attempted                                 | When a user executes a search query by inputting a keyword and causing a request to be made                                                                                                                                                         | query                      | search keyword or query executed                                                                                          | rides, *                                                                                                                                        |
|                                                         |                                                                                                                                                                                                                                                     | context                    | search context the query was executed under                                                                               | Dashboards, Datasets, KnowledgeCards, Persons, DBT_MODEL, LOOKER_EXPLORE, LOOKER_VIEW                                                           |
|                                                         |                                                                                                                                                                                                                                                     | interaction                | interaction performed by the user to trigger the search                                                                   | click, enter                                                                                                                                    |
|                                                         |                                                                                                                                                                                                                                                     | latency                    | how long the search result took to be rendered on the screen in ms                                                        | 300, 20000                                                                                                                                      |
|                                                         |                                                                                                                                                                                                                                                     | facets                     | facets that were used to constrain the search                                                                             | authors, knowledge card types, hashtags                                                                                                         |
|                                                         |                                                                                                                                                                                                                                                     | selectedFacets             | facets that were used to constrain the search                                                                             | [authors, knowledge card types, hashtags]                                                                                                       |
|                                                         |                                                                                                                                                                                                                                                     | selectedFilters            | filters that were used to constrain the search                                                                            | [dashboardFilters, datasetFilters]                                                                                                              |
| Search suggestion selected                              | When a user inputs a set of characters in the search input field and suggested input is selected                                                                                                                                                    | input                      | characters entered to trigger the suggestion results                                                                      | rides, *                                                                                                                                        |
|                                                         |                                                                                                                                                                                                                                                     | context                    | search context the query was selected for                                                                                 | Dashboards, Datasets, KnowledgeCards, Persons, DBT_MODEL, LOOKER_EXPLORE, LOOKER_VIEW                                                           |
|                                                         |                                                                                                                                                                                                                                                     | interaction                | interaction performed by the user to select suggestions                                                                   | click, enter                                                                                                                                    |
|                                                         |                                                                                                                                                                                                                                                     | latency                    | how long the suggestion results took to be rendered on the screen in ms                                                   | 300, 20000                                                                                                                                      |
|                                                         |                                                                                                                                                                                                                                                     | suggestion_selected        | value of the selected suggestion                                                                                          | acme.ride_share.rides_by_month_2017                                                                                                             |
| Search top_hashtag selected                             | When a user executes the primary action related to a top hashtag                                                                                                                                                                                    | hashtag                    | the value of the selected hashtag                                                                                         | subscriptions                                                                                                                                   |
| Support feedback_form accessed                          | When a viewer interacts with a link to navigate to the external feedback form                                                                                                                                                                       |                            |                                                                                                                           |                                                                                                                                                 |
| Support support_center accessed                         | When a viewer interacts with a link to navigate to the external support / help page                                                                                                                                                                 |                            |                                                                                                                           |                                                                                                                                                 |
|                                                         |                                                                                                                                                                                                                                                     | cta                        | the cta that the viewer interacted with on the top contributor interface                                                  | search, profile, email, slack                                                                                                                   |
| Onboarding slack installed                              | When a slack user installs the Metaphor Slack app                                                                                                                                                                                                   | person_id                  | the identifier of the viewer                                                                                              | PERSON~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                         |
| Engagement linege_graph interacted                      | When a user performs any interactive action on a lineage graph                                                                                                                                                                                      | num_nodes_shown            | the number of nodes in the lineage graph                                                                                  | 1, 30, 40,50,100                                                                                                                                |
|                                                         |                                                                                                                                                                                                                                                     | asset_id                   |                                                                                                                           | DATASET~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                        |
|                                                         |                                                                                                                                                                                                                                                     | latency                    | how long it took for the lineage graph to be rendered in ms                                                               | 300, 20000                                                                                                                                      |
|                                                         |                                                                                                                                                                                                                                                     | asset_type                 | the type of the asset being viewed                                                                                        | Dashboard, Dataset, KnowledgeCards                                                                                                              |
| Engagement share_asset performed                        | When a user interacts with the share interface and performs a related action                                                                                                                                                                        | asset_id                   | global identifier for the asset                                                                                           | DATASET~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                        |
|                                                         |                                                                                                                                                                                                                                                     | type                       | the share action performed / interacted with by the user                                                                  | copyLink, shareViaSlack, shareViaEmail                                                                                                          |
| Engagement config_ownership interacted                  | When user performs a cta within the configured ownership interface                                                                                                                                                                                  |                            |                                                                                                                           |                                                                                                                                                 |
|                                                         |                                                                                                                                                                                                                                                     | owner                      | optional field that if filled indicates interaction a person captured in Metaphor                                         | DATASET~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                        |
|                                                         |                                                                                                                                                                                                                                                     |                            |                                                                                                                           |                                                                                                                                                 |
|                                                         |                                                                                                                                                                                                                                                     | external                   | optional field that if filled indicates interaction the external owner                                                    | external@example.com                                                                                                                            |
| Engagement knowledge_card creation_attempted            | When a user attempts to create a knowledge card                                                                                                                                                                                                     | cta                        | the cta that the viewer interacted with on the configurable ownership interface                                           | profile, email, slack                                                                                                                           |
|                                                         |                                                                                                                                                                                                                                                     | card_type                  | type of the card created                                                                                                  | HOW_TO_USE, INCIDENT, DEPRECATION                                                                                                               |
|                                                         |                                                                                                                                                                                                                                                     | anchor_id                  | the asset identifier for the asset that the knowledge card is created against                                             | DATASET~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                        |
|                                                         |                                                                                                                                                                                                                                                     | num_char_body              | number of characters that a person has entered in the main body, typically the description of the knowledge card          | 100, 200, 500, 1000                                                                                                                             |
|                                                         |                                                                                                                                                                                                                                                     | plannedDate                |                                                                                                                           | 2021-11-02T22:18:40.420Z                                                                                                                        |
| Engagement knowledge_card filtered_display              | When a user successfully filters knowledge cards under the knowledge cards tab on an asset page                                                                                                                                                     | filters                    |                                                                                                                           | authors, knowledge card types, hashtags                                                                                                         |
| Engagement knowledge_card edited                        | When a user edits an existing knowledge card                                                                                                                                                                                                        | asset_id                   | global identifier for the asset                                                                                           | KNOWLEDGE_CARD~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                 |
| Engagement knowledge_card unsuccessful_creation         | When a user attempts to create a knowledge card but exits out of the creation flow before successful completion                                                                                                                                     | did_change_defaults        |                                                                                                                           | true, false                                                                                                                                     |
|                                                         |                                                                                                                                                                                                                                                     | anchor_id                  | the asset identifier for the asset that the knowledge card is created against                                             | DATASET~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                        |
| Engagement knowledge_card archived                      | When a user archives a knowledge card                                                                                                                                                                                                               | asset_id                   | global identifier for the asset                                                                                           | KNOWLEDGE_CARD~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                 |
| Engagement asset_page from_slack                        | When a slack user navigates to an entity page from a Metaphor Slack generated link                                                                                                                                                                  | asset_id                   | global identifier for the asset                                                                                           | KNOWLEDGE_CARD~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                 |
| Engagement asset followed                               | A user follows an asset by interacting with a follow control to become a follower of that asset                                                                                                                                                     | asset_id                   | global identifier for the asset                                                                                           | KNOWLEDGE_CARD~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                 |
| Engagement asset unfollowed                             | A user unfollows an asset by interacting with a follow control to no longer be a follower of the asset                                                                                                                                              | asset_id                   | global identifier for the asset                                                                                           | KNOWLEDGE_CARD~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                 |
| Engagement governed_tag assigned                        | When a user assigns a governed tag to an asset                                                                                                                                                                                                      | asset_id                   | global identifier for the asset                                                                                           | KNOWLEDGE_CARD~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                 |
|                                                         |                                                                                                                                                                                                                                                     | tag_id                     | global identifier for the tag                                                                                             | USER_DEFINED_RESOURCE~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                          |
|                                                         |                                                                                                                                                                                                                                                     |                            |                                                                                                                           |                                                                                                                                                 |
| Engagement governed_tag unassigned                      | When a user unassigns a governed tag to an asset that it was previously assigned to                                                                                                                                                                 | asset_id                   | global identifier for the asset                                                                                           | KNOWLEDGE_CARD~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                 |
|                                                         |                                                                                                                                                                                                                                                     | tag_id                     | global identifier for the tag                                                                                             | USER_DEFINED_RESOURCE~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                          |
|                                                         |                                                                                                                                                                                                                                                     |                            |                                                                                                                           |                                                                                                                                                 |
| Engagement asset_description added                      | When a user adds a crowd sourced description to a data asset                                                                                                                                                                                        | asset_id                   | global identifier for that asset                                                                                          | DATASET~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                        |
| Engagement directory created                            | When a user adds a new directory to metaphor                                                                                                                                                                                                        | directory_id               | global identifier for the directory                                                                                       | NAMESPACE~4BD8F73EBEB8CB15E0B01547B0425FA5                                                                                                      |
|                                                         |                                                                                                                                                                                                                                                     | name_at_creation           | The name of the directory at the time of creation                                                                         | my dir                                                                                                                                          |
| Engagement knowledge_card created                       | When a user successfully creates to create a knowledge card                                                                                                                                                                                         | cta                        | the cta that the viewer interacted with                                                                                   | profile, email, slack                                                                                                                           |
|                                                         |                                                                                                                                                                                                                                                     | card_type                  | type of the card created                                                                                                  | HOW_TO_USE, INCIDENT, DEPRECATION                                                                                                               |
|                                                         |                                                                                                                                                                                                                                                     | asset_id                   | global identifier for the knowledge card                                                                                  | KNOWLEDGE_CARD~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                 |
|                                                         |                                                                                                                                                                                                                                                     | anchor_id                  | the asset identifier for the asset that the knowledge card is created against                                             | DATASET~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                        |
|                                                         |                                                                                                                                                                                                                                                     | num_char_body              | number of characters that a person has entered in the main body, typically the description of the knowledge card          | 100, 200, 500, 1000                                                                                                                             |
|                                                         |                                                                                                                                                                                                                                                     | plannedDate                |                                                                                                                           | 2021-11-02T22:18:40.420Z                                                                                                                        |
| Engagement lineage panel_opened                         | When a viewer opens the analysis panel on a lineage graph when the mode is impact analysis                                                                                                                                                          | asset_id                   | global identifier for the asset                                                                                           | DATASET~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                        |
| Engagement lineage impact_analysis_mode_shown           | A user opts to view the lineage graph in impact analysis mode by toggling the switch to the on state                                                                                                                                                | asset_id                   | global identifier for the asset                                                                                           | DATASET~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                        |
| Engagement lineage associated_user_list_accessed        | A user downloads, copies or accesses the list of users that are associated with a data asset under impact analysis mode                                                                                                                             | access_type                | global identifier for the asset                                                                                           | copy, download, view                                                                                                                            |
|                                                         |                                                                                                                                                                                                                                                     | asset_id                   | global identifier for the asset                                                                                           | DATASET~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                        |
| Engagement lineage node_details_viewed                  | A viewer interacts with a node in the graph to show the details of the asset represented by that node within the rendered graph bounds The viewer must be in impact analysis mode to trigger this event and spend sufficient dwell time on the node | asset_id                   | global identifier for the asset                                                                                           | DATASET~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                        |
| Engagement document copied                              | A viewer copies a document using a copy document action                                                                                                                                                                                             | asset_id                   | global identifier for the document being copied                                                                           | KNOWLEDGE_CARD~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                 |
| Engagement document created                             | A viewer successfully creates a new document                                                                                                                                                                                                        | asset_id                   | global identifier for the document that was created                                                                       | KNOWLEDGE_CARD~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                 |
| Engagement document moved                               | A viewer moves a document using the move document action                                                                                                                                                                                            | asset_id                   | global identifier for the asset                                                                                           | KNOWLEDGE_CARD~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                 |
|                                                         |                                                                                                                                                                                                                                                     | moved_to_dir_with_id       | global identifier for the directory the document was moved to                                                             | NAMESPACE~4BD8F73EBEB8CB15E0B01547B0425FA5                                                                                                      |
| Engagement column_governed_tag assigned                 | When a viewer assigns a governed tag to a column or field path in an asset                                                                                                                                                                          | column_names               | Array of affected column names / fieldPaths                                                                               | ["user_id", "order_id"]                                                                                                                         |
|                                                         |                                                                                                                                                                                                                                                     | asset_id                   | The asset id for the dataset                                                                                              | DATASET~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                        |
|                                                         |                                                                                                                                                                                                                                                     | tags_added                 | Array of governed tag names added                                                                                         | ["gold", "marketing/eu"]                                                                                                                        |
| Engagement column_governed_tag unassigned               | When a viewer unassigns a governed tag to a column or field path that it was previously assigned to                                                                                                                                                 | column_names               | Array of affected column names / fieldPaths                                                                               | ["user_id", "order_id"]                                                                                                                         |
|                                                         |                                                                                                                                                                                                                                                     | asset_id                   | The asset id for the dataset                                                                                              | DATASET~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                        |
|                                                         |                                                                                                                                                                                                                                                     | tags_removed               | Array of governed tag names removed                                                                                       | ["gold", "marketing/eu"]                                                                                                                        |
| Engagement column_description added                     | When a viewer adds a crowd sourced description to a field / column on a data asset, typically a dataset                                                                                                                                             | column_name                | The column name that the description was created for                                                                      | order_id                                                                                                                                        |
|                                                         |                                                                                                                                                                                                                                                     | asset_id                   | The asset id for the dataset                                                                                              | DATASET~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                        |
| Engagement bulk_action governed_tags_updated            | When a viewer updates the governed tags for a set of assets using the bulk action feature to select one or more assets                                                                                                                              | number_of_objects_impacted | The number of objects (assets, columns, etc) selected and acted upon in the bulk operation                                | 1,4,30                                                                                                                                          |
|                                                         |                                                                                                                                                                                                                                                     | tags_added                 | Array of governed tag names added                                                                                         | ["gold", "marketing/eu"]                                                                                                                        |
|                                                         |                                                                                                                                                                                                                                                     | tags_removed               | Array of governed tag names removed                                                                                       | ["gold", "marketing/eu"]                                                                                                                        |
| Engagement bulk_action asset_contacts_updated           | When a viewer updates / manages the asset contacts for a set of assets using the bulk action features to select one or more assets                                                                                                                  | number_of_objects_impacted | The number of objects (assets, columns, etc) selected and acted upon in the bulk operation                                | 1,5,23                                                                                                                                          |
|                                                         |                                                                                                                                                                                                                                                     | contacts_types_added       | The array of unique identifiers for the contact types that were added                                                     | ["USER_DEFINED_RESOURCE~2AE5D58F67BA72CBD8F94604F7FC234D"]                                                                                      |
|                                                         |                                                                                                                                                                                                                                                     | contacts_types_removed     | The array of unique identifiers for the contact types that were removed                                                   | ["USER_DEFINED_RESOURCE~2AE5D58F67BA72CBD8F94604F7FC234D"]                                                                                      |
| Engagement who_viewed_this_asset opened                 | When a viewer toggles open a control displaying the people who have viewed an asset                                                                                                                                                                 | asset_id                   | global identifier for the asset                                                                                           | DATASET~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                        |
| Engagement directory documents_filtered                 | When a viewer successfully filters documents under a directory page                                                                                                                                                                                 | statuses                   | Array of statuses used to filter the directory                                                                            | ["ARCHIVED" , "DRAFT" , "PUBLISHED"]                                                                                                            |
|                                                         |                                                                                                                                                                                                                                                     | tags                       | Array of governed tag names used to filter the directory                                                                  | ["gold", "marketing/eu"]                                                                                                                        |
|                                                         |                                                                                                                                                                                                                                                     | directory_id               | global identifier for the directory                                                                                       | NAMESPACE~4BD8F73EBEB8CB15E0B01547B0425FA5                                                                                                      |
| Engagement change_request sent                          | When a change request is sent by a viewer                                                                                                                                                                                                           | anchor_id                  | global identifier for the anchor asset                                                                                    | DATASET~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                        |
|                                                         |                                                                                                                                                                                                                                                     | asset_id                   | global identifier for the change request that was sent                                                                    | KNOWLEDGE_CARD~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                 |
|                                                         |                                                                                                                                                                                                                                                     | type                       | symbol for the change request type                                                                                        | ASSET_ACCESS, COLUMN_UPDATE, CONTACTS_UPDATE, CONTENT_UPDATE, DESCRIPTION_UPDATE, TAGS_UPDATE,                                                  |
| Engagement change_request status_change_attempted       | When user attempts to change the status                                                                                                                                                                                                             | asset_id                   | global identifier for the change request                                                                                  | KNOWLEDGE_CARD~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                 |
|                                                         |                                                                                                                                                                                                                                                     | status                     | The current status of the change request                                                                                  | OPEN                                                                                                                                            |
| Engagement change_request status_changed                | When the status of a change request is changed                                                                                                                                                                                                      | asset_id                   | global identifier for the change request                                                                                  | KNOWLEDGE_CARD~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                 |
|                                                         |                                                                                                                                                                                                                                                     | status                     | The new status of the change request                                                                                      | CLOSED                                                                                                                                          |
| Engagement change_request acknowledged                  | When a change request is acknowledged by a recipient                                                                                                                                                                                                | anchor_id                  | global identifier for the anchor asset                                                                                    | DATASET~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                        |
|                                                         |                                                                                                                                                                                                                                                     | asset_id                   | global identifier for the change request that was acknowledged                                                            | KNOWLEDGE_CARD~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                 |
|                                                         |                                                                                                                                                                                                                                                     | type                       | symbol for the change request type                                                                                        | ASSET_ACCESS, COLUMN_UPDATE, CONTACTS_UPDATE, CONTENT_UPDATE, DESCRIPTION_UPDATE, TAGS_UPDATE,                                                  |
| Engagement data_group created                           | A viewer successfully creates a new data group (data domain)                                                                                                                                                                                        | data_group_id              | global identifier for the document that was created                                                                       | NAMESPACE~4E9584DFBF78A16886E7D234393C1304                                                                                                      |
| Engagement data_group moved                             | A viewer moves a data_group (data domain) using the move domain action                                                                                                                                                                              | data_group_id              | global identifier for the data group                                                                                      | NAMESPACE~944F076881BEE131E05C6B39134E4FD9                                                                                                      |
|                                                         |                                                                                                                                                                                                                                                     | moved_to_parent_id         | global identifier for the destination data group the source domain was moved to. Will be null if moved to the top level   | NAMESPACE~4BD8F73EBEB8CB15E0B01547B0425FA5                                                                                                      |
| Engagement directory moved                              | A viewer moves a user_defined_space (directory) using the move directory action                                                                                                                                                                     | directory_id               | global identifier for the directory                                                                                       | NAMESPACE~16434633EB85DF03EC87B003FB882E90                                                                                                      |
|                                                         |                                                                                                                                                                                                                                                     | moved_to_parent_id         | global identifier for the destination directory the source directory was moved to. Will be null if moved to the top level | NAMESPACE~16434633EB85DF03EC87B003FB882E90                                                                                                      |
| Engagement additional_asset_likers shown                | A viewer revealed a list of additional people who liked an asset                                                                                                                                                                                    | asset_id                   | global identifier for the asset that was opened                                                                           | KNOWLEDGE_CARD~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                 |
|                                                         |                                                                                                                                                                                                                                                     | performed_by_author        | indicates that the action was performed by the author of the related asset                                                | true, false                                                                                                                                     |
| Engagement app_home opened                              | A user open Slack Metaphor Home tab                                                                                                                                                                                                                 |                            |                                                                                                                           |                                                                                                                                                 |
| Engagement link_unfurling performed                     | When a user share Metaphor asset in Slack or Teams                                                                                                                                                                                                  | asset_id                   | global identifier for the asset that was shared                                                                           | KNOWLEDGE_CARD~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                 |
| Engagement share_asset attempted                        | When a user interacts with the share dialog                                                                                                                                                                                                         | asset_id                   | global identifier for the asset that was opened the share dialog in Slack                                                 | KNOWLEDGE_CARD~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                 |
| Engagement version_history history_list_shown           | When a viewer opens the version history list                                                                                                                                                                                                        | asset_id                   | global identifier for the asset the version history list was shown for                                                    | DATASET~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                        |
| Engagement version_history version_requested            | When a viewer successfully requests a previous version of an asset to be viewed                                                                                                                                                                     | asset_id                   | global identifier for the asset the version history list was shown for                                                    | DATASET~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                        |
|                                                         |                                                                                                                                                                                                                                                     | version_id                 | identifer for the selected version                                                                                        | 63bef5bf9588a3c08edaf637                                                                                                                        |
| Engagement app installed                                | When a user install the application                                                                                                                                                                                                                 |                            |                                                                                                                           |                                                                                                                                                 |
| Engagement app uninstalled                              | When a user uninstall the application                                                                                                                                                                                                               |                            |                                                                                                                           |                                                                                                                                                 |
| Engagement asset pinned                                 | A viewer pins an asset into thier personal pins collection by interacting with a pin control                                                                                                                                                        | asset_id                   | global identifier for the asset that was pinned                                                                           | KNOWLEDGE_CARD~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                 |
| Engagement asset unpinned                               | A viewer unpins an asset into thier personal pins collection by interacting with a pin / unpin control                                                                                                                                              | asset_id                   | global identifier for the asset that was unpinned                                                                         | KNOWLEDGE_CARD~2AE5D58F67BA72CBD8F94604F7FC234D                                                                                                 |
| Engagement request_instance_form shown                  | The request an instance form is made visible to the viewer                                                                                                                                                                                          | viewer_email               | The email of the logged in user may be different from the submitted email if the form is eventually submitted             | username@company_domain.tld                                                                                                                     |
| Engagement request_instance_form submitted              | The request an instance calendar form is submitted by the viewer                                                                                                                                                                                    | viewer_email               | The email of the logged in user, may be different from the submitted email                                                | username@company_domain.tld                                                                                                                     |
| Engagement asset_contact updated                        | When a viewer updates the asset contacts for an asset                                                                                                                                                                                               | contact_types_added        | The array of unique identifiers for the contact types that were added                                                     | ["USER_DEFINED_RESOURCE~2AE5D58F67BA72CBD8F94604F7FC234D"]                                                                                      |
| Search semantic search attempted                        |                                                                                                                                                                                                                                                     | query                      | The query entered by the user                                                                                             | How is revenue calculated                                                                                                                       |
|                                                         |                                                                                                                                                                                                                                                     | qaResponse                 | The response returned by the bot (expected to be a string of around 4-5 lines)                                            | Revenue is calculated by multipling number of units times sales price                                                                           |
|                                                         | When a user queries the Slack/Teams bot to run a semantic search                                                                                                                                                                                    | searchResults              | The search results returned by the bot                                                                                    | ["https://stage.metaphor.io/document/3AF127AD88C49B23D0EEE000EB327F47", "https://stage.metaphor.io/document/3AF127AD88C49B23D0EEE000EB327F47"]  |
| Engagement coverage_analytics shown                     | The coverage analytics widget is made visible to the viewer                                                                                                                                                                                         |                            |                                                                                                                           |                                                                                                                                                 |
| Engagement saved_search created                         | When a user saves search query to the "saved searches"                                                                                                                                                                                              | name                       | Name of the saved search                                                                                                  | Datasets with tags                                                                                                                              |
|                                                         |                                                                                                                                                                                                                                                     | keyword                    | Search query                                                                                                              | has:tag                                                                                                                                         |
|                                                         |                                                                                                                                                                                                                                                     | context                    | Search context                                                                                                            | Datasets                                                                                                                                        |
|                                                         |                                                                                                                                                                                                                                                     | facetsJSON                 | Search filters if any                                                                                                     | {}                                                                                                                                              |
| Engagement saved_search applied                         | When a user applies saved search to see the results                                                                                                                                                                                                 | name                       | Name of the saved search                                                                                                  | John's Dashboards                                                                                                                               |
|                                                         |                                                                                                                                                                                                                                                     | keyword                    | Search query                                                                                                              | author:john                                                                                                                                     |
|                                                         |                                                                                                                                                                                                                                                     | context                    | Search context                                                                                                            | Dashboards                                                                                                                                      |
|                                                         |                                                                                                                                                                                                                                                     | facetsJSON                 | facetsJSON                                                                                                                | {}                                                                                                                                              |
| Onboarding persona created                              | When user picks persona from onboarding page after login                                                                                                                                                                                            | persona                    | Persona value that user picks                                                                                             | DATA_PRODUCER                                                                                                                                   |
| Onboarding persona updated                              | When user changes persona from profile setting page                                                                                                                                                                                                 | persona                    | Persona value that user picks from dropdown                                                                               | DATA_PRODUCER                                                                                                                                   |
| Engagement universal_search liked                       | When user likes the universal search answer                                                                                                                                                                                                         | question                   | The question to be answered                                                                                               | What is KPI?                                                                                                                                    |
|                                                         |                                                                                                                                                                                                                                                     | answer                     | The answer which user likes                                                                                               | KPI stands for Key Performance Indicator.                                                                                                       |
| Engagement universal_search disliked                    | When user dislikes the universal search answer                                                                                                                                                                                                      | question                   | The question to be answered                                                                                               | What is KPI?                                                                                                                                    |
|                                                         |                                                                                                                                                                                                                                                     | answer                     | The answer which user likes                                                                                               | KPI stands for Key Performance Indicator.                                                                                                       |
|                                                         |                                                                                                                                                                                                                                                     | feedback                   | The additional feedback user entered when disliking the answer                                                            | The answer isn't accurate                                                                                                                       |
| Engagement extension_popup opened                       | When user opens extension popup by clicking on the extesion icon or draggable widget                                                                                                                                                                | asset_id                   | global identifier for the asset that was opened in the extension popup                                                    | DASHBOARD~08D4646C256048E699349C372C3322C6                                                                                                      |
| Engagement extension_popup closed                       | When user closes extension popup by clicking on the extesion icon, draggable widget or outside of the popup                                                                                                                                         | asset_id                   | global identifier for the asset that was closed in the extension popup                                                    | DASHBOARD~08D4646C256048E699349C372C3322C6                                                                                                      |
| General extension installed                             | When user installs extenion, enters their company domain and opens extension popup for the very first time                                                                                                                                          |                            |                                                                                                                           |                                                                                                                                                 |
| Engagement list_of_viewers_from_source_system shown     | When user opens a side panel for the lineage node, goes to Impact Analysis tab and click on the button, that reveals list of all viewers from the source system for that asset                                                                      | asset_id                   | global identifier for the asset list of viewers was opened for                                                            | DASHBOARD~08D4646C256048E699349C372C3322C6                                                                                                      |
| Engagement list_of_subscribers_from_source_system shown | When user opens a side panel for the lineage node, goes to Impact Analysis tab and click on the button, that reveals list of all subscribers from the source system for that asset                                                                  | asset_id                   | global identifier for the asset list of subscribers was opened for                                                        | DASHBOARD~08D4646C256048E699349C372C3322C6                                                                                                      |
| Search search_result primary_action_performed           | Viewer performed the primary action on a search result after viewing a set of search results                                                                                                                                                        | query                      | search keyword or query executed                                                                                          | rides, *                                                                                                                                        |
|                                                         |                                                                                                                                                                                                                                                     | context                    | search context the query was executed under                                                                               | Dashboards, Datasets, KnowledgeCards, Persons, DBT_MODEL, LOOKER_EXPLORE, LOOKER_VIEW                                                           |
|                                                         |                                                                                                                                                                                                                                                     | position                   | The 1-based index of the search result within the result set for the current query                                        |                                                                                                                                           1, 10 |
|                                                         |                                                                                                                                                                                                                                                     | asset_id                   | global identifier for the asset that was clicked                                                                          | DASHBOARD~08D4646C256048E699349C372C3322C6                                                                                                      |
|                                                         |                                                                                                                                                                                                                                                     | facets                     | facets that were used to constrain the search                                                                             | authors, knowledge card types, hashtags                                                                                                         |
| Search search_result impression                         | A search result has been displayed in the viewport and may have been viewed by a viewer                                                                                                                                                             | query                      | search keyword or query executed                                                                                          | rides, *                                                                                                                                        |
|                                                         |                                                                                                                                                                                                                                                     | context                    | search context the query was executed under                                                                               | Dashboards, Datasets, KnowledgeCards, Persons, DBT_MODEL, LOOKER_EXPLORE, LOOKER_VIEW                                                           |
|                                                         |                                                                                                                                                                                                                                                     | asset_id                   | global identifier for the asset that was impressed                                                                        | DASHBOARD~08D4646C256048E699349C372C3322C6                                                                                                      |
|                                                         |                                                                                                                                                                                                                                                     | position                   | The 1-based index of the search result within the result set for the current query                                        |                                                                                                                                           1, 10 |
|                                                         |                                                                                                                                                                                                                                                     | facets                     | facets that were used to constrain the search                                                                             | authors, knowledge card types, hashtags                                                                                                         |
| Engagement search_result_action_menu opened             | When user opens the search result action menu                                                                                                                                                                                                       | query                      | search keyword or query executed                                                                                          | rides, *                                                                                                                                        |
| Engagement non_production_assets_switch changed         | When the non-prod assets switch state changed                                                                                                                                                                                                       | state                      | The new state of the switch. "true" means non-prod assets are shown, "false" means non-prod assets are hidden.            | true/false                                                                                                                                      |
| Engagement comment added                                | When a viewer adds a new comment, typically to a knowledge card (post  / notice)                                                                                                                                                                    | comment_id                 | The id of the newly added comment or reply                                                                                | KNOWLEDGE_CARD~55E5D58F67BA72CBD8F94604F7FC234D                                                                                                 |
|                                                         |                                                                                                                                                                                                                                                     | asset_id                   | The asset id that the comment / reply applies to                                                                          | KNOWLEDGE_CARD~2BE5D58F67BA72CBD8F94604F7FC2344                                                                                                 |
|                                                         |                                                                                                                                                                                                                                                     | is_reply                   | Indicates if this is a reply to another comment / reply in a thread                                                       | true/false                                                                                                                                      |
|                                                         |                                                                                                                                                                                                                                                     | parent_comment_id          | Optional. Present if this is a reply to a comment                                                                         | KNOWLEDGE_CARD~AAE5D58F67BA72CBD8F94604F7FC234C                                                                                                 |
| Search search_result non_primary_action_performed       | Viewer performed the non-primary call to action on a search result after viewing a set of search results                                                                                                                                            | query                      | search keyword or query executed                                                                                          | rides, *                                                                                                                                        |
|                                                         |                                                                                                                                                                                                                                                     | context                    | search context the query was executed under                                                                               | Dashboards, Datasets, KnowledgeCards, Persons, DBT_MODEL, LOOKER_EXPLORE, LOOKER_VIEW                                                           |
|                                                         |                                                                                                                                                                                                                                                     | position                   | The 1-based index of the search result within the result set for the current query                                        |                                                                                                                                           1, 10 |
|                                                         |                                                                                                                                                                                                                                                     | asset_id                   | global identifier for the asset that was impressed                                                                        | DASHBOARD~08D4646C256048E699349C372C3322C6                                                                                                      |
|                                                         |                                                                                                                                                                                                                                                     | facets                     | facets that were used to constrain the search                                                                             | authors, knowledge card types, hashtags                                                                                                         |
|                                                         |                                                                                                                                                                                                                                                     | label                      | The display name or label specifying the call to action for the secondary search result control                           | Quick View, Follow                                                                                                                              |
| Engagement support_widget opened                        | When a viewer opens the support widget - Intercom or Canny                                                                                                                                                                                          | widget                     | Identificator of the widget to be opened                                                                                  | intercom' or 'canny';                                                                                                                           |
| Engagement data_quality_widget opened                   | When a viewer opens the data quality widget on an asset page                                                                                                                                                                                        | dataQualityStatus          | Asset data quality status                                                                                                 | "TRANSITIVE_WARNING" \| "ERROR" \| "PASSED" \| "UNKNOWN" \| "WARNING"                                                                           |
| Engagement data_quality_widget closed                   | When a viewer closes the data quality widget on an asset page                                                                                                                                                                                       | dataQualityStatus          | Asset data quality status                                                                                                 | "TRANSITIVE_WARNING" \| "ERROR" \| "PASSED" \| "UNKNOWN" \| "WARNING"                                                                           |
| Engagement data_quality_source_asset viewed             | When a viewer clicks on the source asset in data quality widget                                                                                                                                                                                     | dataQualityStatus          | Asset data quality status                                                                                                 | "TRANSITIVE_WARNING" \| "ERROR" \| "PASSED" \| "UNKNOWN" \| "WARNING"                                                                           |
| Engagement data_quality_show_details clicked            | When a viewer clicks on the show details button in lineage side panel                                                                                                                                                                               | dataQualityStatus          | Asset data quality status                                                                                                 | "TRANSITIVE_WARNING" \| "ERROR" \| "PASSED" \| "UNKNOWN" \| "WARNING"                                                                           |
| Engagement data_quality_column_status clicked           | When a viewer clicks on the column status in columns tab                                                                                                                                                                                            | dataQualityStatus          | Column data quality status                                                                                                | "TRANSITIVE_WARNING" \| "ERROR" \| "PASSED" \| "UNKNOWN" \| "WARNING"                                                                           |
| Engagement common_attribute added                       | When a viewer creates a common attribute                                                                                                                                                                                                            | name                       | the name of the common attribute                                                                                          | user_id, AVERAGE_COUNT                                                                                                                          |
|                                                         |                                                                                                                                                                                                                                                     | tags_count                 | how many tags associated with common attribute                                                                            |                                                                                                                                              42 |
|                                                         |                                                                                                                                                                                                                                                     | contacts_count             | how many contacts associated with common attribute                                                                        |                                                                                                                                              10 |
| Engagement common_attribute deleted                     | When a viewer deletes a common attribute                                                                                                                                                                                                            | name                       | the name of the common attribute                                                                                          | user_id, AVERAGE_COUNT                                                                                                                          |
|                                                         |                                                                                                                                                                                                                                                     | tags_count                 | how many tags associated with common attribute                                                                            |                                                                                                                                              42 |
|                                                         |                                                                                                                                                                                                                                                     | contacts_count             | how many contacts associated with common attribute                                                                        |                                                                                                                                              10 |
| Engagement common_attribute edited                      | When a viewer edits a common attribute                                                                                                                                                                                                              | name                       | the name of the common attribute                                                                                          | user_id, AVERAGE_COUNT                                                                                                                          |
|                                                         |                                                                                                                                                                                                                                                     | tags_count                 | how many tags associated with common attribute                                                                            |                                                                                                                                              42 |
|                                                         |                                                                                                                                                                                                                                                     | contacts_count             | how many contacts associated with common attribute                                                                        |                                                                                                                                              10 |
| Engagement common_attribute_creation cancelled          | When a viewer cancels common attribute creation flow                                                                                                                                                                                                |                            |                                                                                                                           |                                                                                                                                                 |
| Engagement activity_feed_item interaction               | A viewer engages with an activity feed item by clicking a link, button element on the feed                                                                                                                                                          | feed_position              | The 1-based index of the activity feed item within the rendered feed                                                      |                                                                                                                                           1, 10 |
|                                                         |                                                                                                                                                                                                                                                     | asset_id                   | global identifier for the asset represented by the feed item the viewer interacted with                                   | DASHBOARD~08D4646C256048E699349C372C3322C6                                                                                                      |
|                                                         |                                                                                                                                                                                                                                                     | asset_name                 | The  human readable name of the asset represented by the feed item                                                        | cleaned_bike_rides                                                                                                                              |
| Engagement activity_feed impression                     | An activity feed is rendered in the DOM and visible to the viewer                                                                                                                                                                                   |                            |                                                                                                                           |                                                                                                                                                 |
| Engagement activity_feed_item impression                | An activity feed item has been displayed in the viewport and may have been viewed by a viewer                                                                                                                                                       | feed_position              | The 1-based index of the activity feed item within the rendered feed                                                      |                                                                                                                                           1, 10 |
|                                                         |                                                                                                                                                                                                                                                     | asset_id                   | global identifier for the asset represented by the feed item the viewer interacted with                                   | DASHBOARD~08D4646C256048E699349C372C3322C6                                                                                                      |
|                                                         |                                                                                                                                                                                                                                                     | asset_name                 | The  human readable name of the asset represented by the feed item                                                        | cleaned_bike_rides                                                                                                                              |
| Engagement activity_feed content_added                  | More content is requested and added when the user scrolls the activity feed                                                                                                                                                                         | size                       | The number of additional items that were added to the feed                                                                |                                                                                                                                              30 |
|                                                         |                                                                                                                                                                                 


</details>

#### Example Queries
Selecting all columns
```shell
SELECT *
FROM events_<customer_id>
LIMIT 5;
```

Selecting relevant columns for event type: Engagement saved_search created
```shell
SELECT NAME, KEYWORD, CONTEXT, FACETSJSON
FROM events_<customer_id>
WHERE EVENT_TYPE = 'Engagement saved_search created';
```

Getting list of semantic searches and results
```shell
SELECT QARESPONSE, SEARCHRESULTS
FROM events_<customer_id>
WHERE EVENT_TYPE = 'Search semantic search attempted';
```

Identifying most popular search queries
```shell
SELECT QUERY, COUNT(*) AS COUNT
FROM events_<customer_id>
WHERE EVENT_TYPE = 'Search search attempted'
GROUP BY QUERY
ORDER BY COUNT(*) DESC;
```

Identifying most popular search filters
```shell
SELECT SELECTEDFACETS, COUNT(*) AS COUNT
FROM events_<customer_id>
WHERE EVENT_TYPE = 'Search search attempted'
GROUP BY SELECTEDFACETS
ORDER BY COUNT(*) DESC;
```

Getting ordered list of identity providers for sign-ins
```shell
SELECT IDENTITY_PROVIDER, COUNT(*) AS COUNT
FROM events_<customer_id>
WHERE EVENT_TYPE = 'General sign_in attempted'
GROUP BY IDENTITY_PROVIDER
ORDER BY COUNT(*) DESC;
```

Identifying users that are signing in the most
```shell
SELECT EMAIL, COUNT(*) AS COUNT
FROM events_<customer_id>
WHERE EVENT_TYPE = 'General sign_in attempted'
GROUP BY EMAIL
ORDER BY COUNT(*) DESC;
```

Identifying users using the semantic search the most
```shell
SELECT EMAIL, COUNT(*) AS COUNT
FROM events_<customer_id>
WHERE EVENT_TYPE = 'Search semantic search attempted'
GROUP BY EMAIL
ORDER BY COUNT(*) DESC;
```

